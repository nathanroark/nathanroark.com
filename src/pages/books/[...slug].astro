---
import { getCollection, render } from "astro:content";
import Layout from "@/layouts/content-layout.astro";
import { Image } from "astro:assets";

export async function getStaticPaths() {
  const posts = await getCollection("books");
  return posts.map((post) => ({
    params: { slug: post.id.replace(/\.md$/, "") },
    props: { post, cleanSlug: post.id.replace(/\.md$/, "") },
  }));
}

const { post, cleanSlug } = Astro.props;
const { Content } = await render(post);
---
<Layout
  title={post.data.title}
  description={`${post.data.title} - ${post.data.author}`}
>
  <div class="overflow-hidden border-b border-zinc-800 px-6 lg:px-0">
    <div class="mx-auto flex w-fit flex-col md:flex-row">
      <div class="relative mr-32 w-72 py-2 shadow-xl md:w-auto">
        <Image
          src={post.data.cover_image}
          alt={cleanSlug}
          width="300"
          height="300"
          class="relative block rounded-md bg-white"
          style={`view-transition-name: transition-${cleanSlug};`}
        />
      </div>
      <div class="flex flex-col justify-center pt-8">
        <h1 class="text-5xl font-bold tracking-tight">
          {post.data.title}
        </h1>
        <p class="mt-3 text-3xl">{post.data.author}</p>
        <p class="mt-2 text-lg">
          {post.data.genres[0]} â€” {post.data.published.toDateString()}
        </p>
      </div>
    </div>
  </div>
  <div
    class="md:prose-md prose mx-auto px-6 py-2 dark:prose-invert md:prose-lg xl:prose-xl lg:px-0"
  >
    <Content />
  </div>
</Layout>
